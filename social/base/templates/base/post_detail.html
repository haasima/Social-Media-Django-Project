{% extends "base.html" %}

{% block title %}{{ object.title }}{% endblock %}

{% block content %}
    <article class="media content-section">
      <img class="rounded-circle article-img" src='{{ object.author.profile.image.url }}'>
        <div class="media-body">
          <div class="article-metadata">
            <a class="mr-2" href="{{ object.author.get_absolute_url }}">{{ object.author }}</a>
            <small class="text-muted">{{ object.date_posted|date:"F d, Y" }}</small>
            <strong class="text-secondary">{{ number_of_likes }} like{{ number_of_likes|pluralize }}</strong>
          </div>
          <h2 class="article-title">{{ object.title }}</h2>
          <p class="article-content">{{ object.content|safe }}</p>
        </div>
      </article>
      {% if user.is_authenticated and object.author != request.user %}
        <div class="form-group">
        <form action="{% url "base:post-like" object.id %}" method="POST">
              {% csrf_token %}
              {% if post_is_liked %}
                <button type="submit" name="post_id" value="{{ object.id }}" class="btn btn-outline-info">Unlike</button>
              {% else %}
                <button type="submit" name="post_id" value="{{ object.id }}" class="btn btn-outline-info">Like</button>
              {% endif %}
        </form>
      {% endif %}
          {% if object.author == user %}
            <div>
              <a class="btn btn-outline-primary btn-sm mt-1 mb-1" href="{% url "base:post-update" object.id %}">Update</a>
              <a class="btn btn-outline-danger btn-sm mt-1 mb-1" href="{% url "base:post-delete" object.id %}">Delete</a>
            </div>
          {% endif %}
        </div>
        <!-- Form to leave comment -->
    {% if user.is_authenticated %}
    <div class="row mt-5">
      <div class="col-lg-6 offset-lg-3">
        <h3>Leave a comment</h3>
        <form method='POST'>
          {% csrf_token %}
          <div class="form-group">
            <span class="ml-2"></span>{{ form.content.label_tag }}
            <textarea class="form-control {% if form.content.errors %}is-invalid{% endif %}" id="id_content"
              name="content" rows="4">{{ form.content.value|default:'' }}</textarea>
          </div>
          <button class="btn btn-primary ml-2" type="submit">Reply</button>
        </form>
      </div>
    </div>
  </div>
  {% endif %}
      <!-- List of comments -->
  {% if comments %}
  <div class="row mt-5">
    <div class="col-lg-6 offset-lg-3">
      Comment{{ comments.count|pluralize }}
      <span class="badge badge-dark ml-2">{{ comments.count }}</span>
    </div>
    {% for comment in comments %}
      <div class="col-lg-6 offset-lg-3 mt-2">
        <div class="card p-2">
          <div class="row">
            <div class="col-12">
              <img class="rounded-circle article-img" src='{{ comment.username.profile.image.url }}'>
              <a class="article-title" href="{{ comment.username.get_absolute_url }}">{{ comment.username }}</a>
            </div>
            <div class="col-12">
              <p class="m-1 mt-3">{{ comment.content }}</p>
              <p class="text-right text-muted"><small>{{ comment.created }}</small></p>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  {% endif %}

{% endblock content %}